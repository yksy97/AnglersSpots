<div class="container mt-4">
  <div class="card">
    <div class="card-header">
      <h2><%= @book.title %></h2>
      <p class="text-muted">登録日時: <%= l @book.created_at, format: :custom_long %></p>
    </div>
    <div class="card-body">
      <p><%= @book.body %></p>

      <!-- 感想フォーム -->
      <%= form_for [@book, BookComment.new], remote: true do |f| %>
        <div class="form-group">
          <%= f.label :comment, "「#{ @book.title }」 の感想" %>
          <%= f.text_area :comment, class: 'form-control', rows: 3 %>
        </div>
        <%= f.submit "投稿する", class: "btn btn-primary" %>
      <% end %>

      <hr>

      <!-- タブ -->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="home-tab" data-toggle="tab" href="#myComment" role="tab" aria-controls="home" aria-selected="true">あなたの感想</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="profile-tab" data-toggle="tab" href="#othersComments" role="tab" aria-controls="profile" aria-selected="false">他のユーザーの感想</a>
        </li>
      </ul>

      <!-- タブの内容 -->
      <div class="tab-content" id="myTabContent">
        <!-- 自分の感想 -->
        <div class="tab-pane fade show active" id="myComment" role="tabpanel" aria-labelledby="home-tab">
          <div id="comments-list">
            <% @book.book_comments.where(customer: current_customer).each do |comment| %>
              <div class="media mt-3">
                <div class="media-body" id="comment-<%= comment.id %>">
                  <p><%= comment.comment %></p>
                  <p class="text-muted">投稿日時: <%= l comment.created_at, format: :custom_long %></p>
                  <%= link_to '編集', '#', class: 'btn btn-sm btn-primary edit-comment-link', data: { comment_id: comment.id }, remote: true %>
                  <%= link_to '削除', book_book_comment_path(@book, comment), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-sm btn-danger', remote: true %>
                </div>
              </div>
              <!-- インライン編集用のフォーム、初期状態では非表示 -->
              <div id="edit-comment-<%= comment.id %>" class="edit-comment-form" style="display: none;">
                <%= form_for [comment.book, comment], remote: true do |f| %>
                  <div class="form-group">
                    <%= f.text_area :comment, value: comment.comment, class: 'form-control', rows: 3 %>
                  </div>
                  <%= f.submit "更新する", class: "btn btn-primary" %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>

        <!-- 他のユーザーの感想 -->
        <div class="tab-pane fade" id="othersComments" role="tabpanel" aria-labelledby="profile-tab">
          <% @book.book_comments.where.not(customer: current_customer).each do |comment| %>
            <div class="media mt-3">
              <div class="media-body">
                <h5 class="mt-0"><%= comment.customer.name %></h5>
                <%= comment.comment %>
                <p class="text-muted"><%= l comment.created_at, format: :custom_long %></p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
